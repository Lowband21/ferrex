#!/usr/bin/env bash
set -euo pipefail

if ! command -v pre-commit >/dev/null 2>&1; then
  echo "pre-commit not found. Install with: pipx install pre-commit (recommended) or pip install --user pre-commit" >&2
  exit 1
fi

repo_root="$(git rev-parse --show-toplevel)"
cd "$repo_root"

# Capture Git's pre-push STDIN (ref updates) and forward to pre-commit,
# along with the original args: <remote-name> <remote-url>.
stdin_file=$(mktemp -t pre-commit-pre-push.XXXXXX)
trap 'rm -f "$stdin_file"' EXIT
cat >"$stdin_file"

exec pre-commit run --hook-stage pre-push --remote-name "${1:-}" --remote-url "${2:-}" <"$stdin_file"
